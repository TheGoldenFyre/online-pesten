<head>
    <script src="/socket.io/socket.io.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
</head>

<body>
    <h1 id="ID">Player: 0</h1>
    <button>Start</button>
    <table>
        <tr>
            <td>Cards: </td>
        </tr>
    </table>
    <script>
        let gs = {}
        let playerNumber = 0
        let isHost = false
        let isAccepted = false
        let lobbyID

        function updateDisplay(socket) {
            $("td").remove()

            gs.playerCards[playerNumber - 1].forEach((card, i) => {
                $("tr").append(`<td id="card${i}">${card.value} of ${card.suitString}s</td>`)
                $(`#card${i}`).click(() => 
                    socket.emit("make-move", {
                        lobbyID: lobbyID,
                        player: playerNumber - 1,
                        index: i
                    })
                )
            })
        }

        function isValidMove(index) {
            
        }

        $(document).ready(() => {
            var socket = io()
            
            lobbyID = window.location.href.split("/").slice(-1).pop()

            socket.emit("connection-request", lobbyID)
            
            socket.on("connection-accept", (data) => {
                isAccepted = true
                console.log(`Player: ${data.ID}`)
                console.log(data.GS)
                gs = data.GS
                playerNumber = data.ID
                $("#ID").text(`Player: ${playerNumber}`)
            })

            socket.on("game-start", (GS) => {
                gs = GS
                console.log(gs)
                
                updateDisplay(socket)
            })

            socket.on("move-made", (GS) => {
                gs = GS
                console.log(gs)

                updateDisplay(socket)
            })

            socket.on("connection-deny", () => {
                console.log("Invalid lobby ID")
            })

            $('button').click(() => {
                socket.emit('start-game', lobbyID);
            });
        })   
    </script>
</body>